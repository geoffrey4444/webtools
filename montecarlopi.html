<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Monte Carlo π Estimator</title>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #f6f7fb;
      --panel: #ffffff;
      --text: #0f172a;
      --muted: #4b5563;
      --accent: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.12);
      --border: #d7dce7;
      --positive: #0ea5e9;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #050814;
        --panel: #0b1020;
        --text: #e5e7eb;
        --muted: #9ca3af;
        --accent: #60a5fa;
        --accent-soft: rgba(96, 165, 250, 0.14);
        --border: #1f2937;
        --positive: #22d3ee;
      }
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      padding: max(16px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right)) max(20px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
      background: radial-gradient(circle at 25% 20%, #dbeafe33, transparent 55%),
                  radial-gradient(circle at 80% 75%, #e0f2fe22, transparent 45%),
                  var(--bg);
      color: var(--text);
      font-family: var(--sans);
      display: flex;
      justify-content: center;
    }

    main {
      width: 100%;
      max-width: 920px;
      background: linear-gradient(140deg, var(--panel), color-mix(in oklab, var(--panel), var(--bg) 10%));
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: clamp(16px, 2vw + 10px, 26px);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12);
    }

    h1 {
      margin: 0 0 6px 0;
      font-size: clamp(1.35rem, 1rem + 1vw, 1.7rem);
      letter-spacing: 0.01em;
    }

    p.lead {
      margin: 0 0 14px 0;
      color: var(--muted);
      max-width: 70ch;
      line-height: 1.5;
    }

    form {
      display: grid;
      grid-template-columns: 2fr auto;
      gap: 10px;
      align-items: end;
    }

    @media (max-width: 600px) {
      form {
        grid-template-columns: 1fr;
        align-items: stretch;
      }
    }

    label {
      display: block;
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input[type="number"] {
      width: 100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: color-mix(in oklab, var(--panel), var(--bg) 12%);
      color: var(--text);
      font-size: 1rem;
    }

    input[type="number"]:focus-visible {
      outline: 2px solid color-mix(in oklab, var(--accent), transparent 60%);
      border-color: color-mix(in oklab, var(--accent), var(--border));
    }

    button {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid color-mix(in oklab, var(--accent), var(--border));
      background: linear-gradient(135deg, color-mix(in oklab, var(--accent), transparent 70%), color-mix(in oklab, var(--accent), transparent 55%));
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(37, 99, 235, 0.25);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .controls {
      background: color-mix(in oklab, var(--panel), var(--bg) 14%);
      border: 1px dashed color-mix(in oklab, var(--border), var(--accent) 15%);
      border-radius: 14px;
      padding: 14px;
      margin: 12px 0 16px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .chip {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: color-mix(in oklab, var(--panel), var(--bg) 18%);
      font-size: 0.9rem;
      cursor: pointer;
    }

    .chip:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .grid {
      display: grid;
      grid-template-columns: 1.15fr 0.85fr;
      gap: 16px;
    }

    @media (max-width: 880px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .card {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 14px;
      background: color-mix(in oklab, var(--panel), var(--bg) 10%);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    }

    .card h2 {
      margin: 0 0 10px 0;
      font-size: 1.05rem;
    }

    .results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
      margin-top: 6px;
    }

    .result-box {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      background: color-mix(in oklab, var(--panel), var(--bg) 20%);
    }

    .result-label {
      display: block;
      font-size: 0.9rem;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .result-value {
      font-family: var(--mono);
      font-size: 1.05rem;
      word-break: break-all;
    }

    canvas {
      width: 100%;
      height: auto;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: color-mix(in oklab, var(--panel), var(--bg) 15%);
      display: block;
    }

    .note {
      margin-top: 10px;
      color: var(--muted);
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .status {
      font-size: 0.95rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .progress {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .progress[hidden] {
      display: none;
    }

    .progress-track {
      position: relative;
      flex: 1;
      height: 10px;
      border-radius: 999px;
      background: color-mix(in oklab, var(--panel), var(--bg) 30%);
      overflow: hidden;
      border: 1px solid var(--border);
    }

    .progress-bar {
      position: absolute;
      inset: 0;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), color-mix(in oklab, var(--accent), var(--positive)));
      transition: width 0.12s ease-out;
    }
  </style>
</head>
<body>
  <main>
    <h1>Monte Carlo π Estimator</h1>
    <p class="lead">Select how many random points to generate inside a unit square. The simulation checks how many land inside a quarter circle to estimate π.</p>

    <form id="pi-form">
      <div>
        <label for="points">Random points</label>
        <input id="points" type="number" inputmode="numeric" min="100" step="100" value="50000" required />
      </div>
      <button id="run" type="submit">Run simulation</button>
    </form>

    <div class="controls">
      <span class="chip" data-points="1000">1,000 pts</span>
      <span class="chip" data-points="10000">10,000 pts</span>
      <span class="chip" data-points="100000">100,000 pts</span>
      <span class="chip" data-points="500000">500,000 pts</span>
      <span class="chip" data-points="1000000">1,000,000 pts</span>
    </div>

    <div class="grid">
      <section class="card">
        <h2>Simulation results</h2>
        <div class="results">
          <div class="result-box">
            <span class="result-label">Estimated π</span>
            <span id="pi-estimate" class="result-value">—</span>
          </div>
          <div class="result-box">
            <span class="result-label">Absolute error</span>
            <span id="pi-error" class="result-value">—</span>
          </div>
          <div class="result-box">
            <span class="result-label">Inside quarter circle</span>
            <span id="inside" class="result-value">—</span>
          </div>
          <div class="result-box">
            <span class="result-label">Runtime</span>
            <span id="runtime" class="result-value">—</span>
          </div>
        </div>
        <div class="status" id="status">Awaiting input…</div>
        <div class="progress" id="progress" hidden>
          <div class="progress-track" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <div class="progress-bar" id="progress-bar"></div>
          </div>
          <span id="progress-label" class="result-label">0%</span>
        </div>
      </section>

      <section class="card">
        <h2>Sample plot</h2>
        <canvas id="plot" width="360" height="360" aria-label="Monte Carlo points plot"></canvas>
        <p class="note">Only a subset of points (up to 4,000) are drawn for clarity. Points inside the quarter circle are highlighted in the accent color.</p>
      </section>
    </div>
  </main>

  <script>
    const form = document.getElementById('pi-form');
    const pointsInput = document.getElementById('points');
    const runBtn = document.getElementById('run');
    const statusEl = document.getElementById('status');
    const piEl = document.getElementById('pi-estimate');
    const errorEl = document.getElementById('pi-error');
    const insideEl = document.getElementById('inside');
    const runtimeEl = document.getElementById('runtime');
    const chips = document.querySelectorAll('.chip');
    const progressEl = document.getElementById('progress');
    const progressBarEl = document.getElementById('progress-bar');
    const progressLabelEl = document.getElementById('progress-label');

    const canvas = document.getElementById('plot');
    const ctx = canvas.getContext('2d');

    const ASYNC_THRESHOLD = 10_000_000;
    const ASYNC_BATCH = 250_000;

    function formatNumber(n) {
      return n.toLocaleString(undefined, { maximumFractionDigits: 6 });
    }

    function setProgress(percent) {
      const pct = Math.min(100, Math.max(0, percent * 100));
      progressEl.hidden = false;
      progressBarEl.style.width = `${pct}%`;
      progressBarEl.parentElement?.setAttribute('aria-valuenow', pct.toFixed(1));
      progressLabelEl.textContent = `${pct.toFixed(1)}%`;
    }

    function resetProgress() {
      progressEl.hidden = true;
      progressBarEl.style.width = '0%';
      progressBarEl.parentElement?.setAttribute('aria-valuenow', '0');
      progressLabelEl.textContent = '0%';
    }

    function clampPoints(value) {
      const min = Number(pointsInput.min) || 0;
      if (!Number.isFinite(value)) return min;
      return Math.max(value, min);
    }

    function drawSample(points, sampleInside) {
      const styles = getComputedStyle(document.documentElement);
      const bg = styles.getPropertyValue('--panel');
      const border = styles.getPropertyValue('--border');
      const accent = styles.getPropertyValue('--accent');
      const muted = styles.getPropertyValue('--muted');
      const positive = styles.getPropertyValue('--positive');
      const sans = (styles.getPropertyValue('--sans') || 'system-ui').trim() || 'system-ui';

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = bg;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.strokeStyle = border;
      ctx.lineWidth = 2;
      ctx.strokeRect(0, 0, canvas.width, canvas.height);

      ctx.strokeStyle = muted;
      ctx.beginPath();
      ctx.arc(0, canvas.height, canvas.width, 0, Math.PI / 2, false);
      ctx.stroke();

      const r = 2.5;
      for (const { x, y, inside } of points) {
        ctx.beginPath();
        ctx.fillStyle = inside ? accent : positive;
        ctx.globalAlpha = inside ? 0.9 : 0.6;
        ctx.arc(x * canvas.width, canvas.height - y * canvas.height, r, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;

      if (sampleInside !== null && points.length) {
        const percent = (sampleInside / points.length) * 100;
        ctx.fillStyle = muted || 'rgba(0,0,0,0.5)';
        ctx.font = `12px ${sans}`;
        ctx.textAlign = 'right';
        ctx.fillText(`Sample inside: ${percent.toFixed(1)}%`, canvas.width - 8, canvas.height - 10);
      }
    }

    function simulate(pointsCount) {
      const start = performance.now();
      let inside = 0;
      const sample = [];
      const sampleLimit = 4000;
      let sampleInside = 0;

      for (let i = 0; i < pointsCount; i++) {
        const x = Math.random();
        const y = Math.random();
        const isInside = x * x + y * y <= 1;
        if (isInside) inside++;
        if (i < sampleLimit) {
          sample.push({ x, y, inside: isInside });
          if (isInside) sampleInside++;
        }
      }

      const elapsed = performance.now() - start;
      const piEstimate = (inside / pointsCount) * 4;
      return { inside, piEstimate, elapsed, sample, sampleInside };
    }

    async function simulateAsync(pointsCount, onProgress) {
      const start = performance.now();
      let inside = 0;
      const sample = [];
      const sampleLimit = 4000;
      let sampleInside = 0;
      let processed = 0;

      while (processed < pointsCount) {
        const batchEnd = Math.min(processed + ASYNC_BATCH, pointsCount);
        for (let i = processed; i < batchEnd; i++) {
          const x = Math.random();
          const y = Math.random();
          const isInside = x * x + y * y <= 1;
          if (isInside) inside++;
          if (i < sampleLimit) {
            sample.push({ x, y, inside: isInside });
            if (isInside) sampleInside++;
          }
        }

        processed = batchEnd;
        if (onProgress) onProgress(processed / pointsCount);
        await new Promise(resolve => requestAnimationFrame(resolve));
      }

      const elapsed = performance.now() - start;
      const piEstimate = (inside / pointsCount) * 4;
      return { inside, piEstimate, elapsed, sample, sampleInside };
    }

    function updateResults({ inside, piEstimate, elapsed, total }) {
      piEl.textContent = formatNumber(piEstimate);
      errorEl.textContent = formatNumber(Math.abs(piEstimate - Math.PI));
      insideEl.textContent = `${inside.toLocaleString()} / ${total.toLocaleString()}`;
      runtimeEl.textContent = `${elapsed.toFixed(1)} ms`;
    }

    chips.forEach(chip => {
      chip.addEventListener('click', () => {
        pointsInput.value = chip.dataset.points;
        pointsInput.focus();
      });
    });

    form.addEventListener('submit', async event => {
      event.preventDefault();
      const desired = clampPoints(Number(pointsInput.value) || 0);
      pointsInput.value = desired;
      if (!Number.isFinite(desired) || desired <= 0) {
        statusEl.textContent = 'Please enter a valid number of points.';
        return;
      }

      runBtn.disabled = true;
      resetProgress();

      const useAsync = desired > ASYNC_THRESHOLD;
      statusEl.textContent = useAsync ? 'Running simulation asynchronously…' : 'Running simulation…';

      const onProgress = progress => {
        setProgress(progress);
        statusEl.textContent = `Running simulation… ${Math.round(progress * 100)}%`;
      };

      const runner = useAsync ? simulateAsync(desired, onProgress) : Promise.resolve(simulate(desired));

      const { inside, piEstimate, elapsed, sample, sampleInside } = await runner;
      if (useAsync) setProgress(1);
      updateResults({ inside, piEstimate, elapsed, total: desired });
      drawSample(sample, sampleInside);
      statusEl.textContent = 'Simulation complete';
      if (!useAsync) resetProgress();
      runBtn.disabled = false;
    });

    drawSample([], null);
  </script>
</body>
</html>
